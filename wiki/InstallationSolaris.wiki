#summary Installation RoR stack on Solaris

Instructions for building a bibapp "zone" running: Java, Ruby, Ruby Enterprise Edition and Apache.

==Directory layout==

The BIBAPP root is /bibapp.

/bibapp/

    __build__/: directory containing source and notes to rebuild the environment from scratch

    source/: source packages for installed software, libraries, etc.

    notes/: notes, copies of build process

    logs/: all application and script logs

    jdk/: the Java JDK(s)

    ruby/: the Ruby environment

    apache/: Apache webserver

    apache/content/: Apache document root

For each toolkit or application installed, there will be a sub-directory for each installed version of the software package. For example: the active Apache directory tree will be /bibapp/apache/apache-2.2.11.

==Programming languages/toolkits==

===Java JDK===

Java 1.6.0_16 (/bibapp/jdk/jdk-1.6.0_16)
    This is the Java installation to be used for the bibapp application. Please do not use any other java installations you may find on the host.

Java install notes:

  # Get the JDK from Sun source, unpack:
    * mkdir /bibapp/__build__/source/jdk/jdk-6u16; cd /bibapp/__build__/source/jdk/jdk-6u16
    * Download, then sftp to SWAPP jdk-6u16-solaris-sparc.sh
    * Download, then sftp to SWAPP jdk-6u16-solaris-sparcv9.sh
    * chmod +x `jdk-6u16-solaris-sparc*.sh`
    * cd /bibapp/jdk
    * /bibapp/__build__/source/jdk/jdk-6u16/jdk-6u16-solaris-sparc.sh
    * /bibapp/__build__/source/jdk/jdk-6u16/jdk-6u16-solaris-sparcv9.sh
  # Configure the JDK environment
    * Add JAVA_HOME to ~bibappadm/.profile, modify the PATH:
      {{{
         JAVA_HOME=/bibapp-qa/jdk/jdk-1.6.0_16
         export JAVA_HOME
         PATH=$JAVA_HOME/bin:$PATH
         export PATH
      }}}
                  
===Ruby===

Ruby Enterprise Edition 1.8.7 (/bibapp/ruby/ruby-enterprise-1.8.7)
    This is the Ruby installation to be used for the bibapp ruby-on-rails application. Will contain installed third party modules.
    BibApp uses the Apache + Passenger stack to serve pages
    The BibApp application is deployed to /bibapp/ruby/bibapp/ 

Ruby install notes:

  # Get Ruby, unpack:
    * $ mkdir /bibapp/ruby
    * $ mkdir /bibapp/logs/ruby
    * $ cd /bibapp/__build__/source
    * $ mkdir ruby; cd ruby
    * $ wget ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p174.tar.gz
    * $ tar xvfz ruby-1.8.7-p174.tar.gz
    * $ cd ruby-1.8.7-p174
  # Compile, make, make install:
    * $ ./configure --prefix=/bibapp/ruby/ruby-1.8.7-p174 --enable-pthread
    * $ cd ext/openssl
    * $ ruby extconf.rb --with-openssl-dir=/usr/sfw
    * $ cd ../..
    * $ make
    * $ make test
    * $ make install
  # Configure the Ruby environment:
    * Add RUBY_HOME to ~bibappadm/.profile, modify the PATH:
      {{{
         RUBY_HOME=/bibapp-qa/ruby/ruby-1.8.7-p174
         export RUBY_HOME
         PATH=$RUBY_HOME/bin:$PATH
         export PATH
      }}}         
    * $ . ~/.profile
  # Get Ruby Enterprise Edition, unpack:
    * $ cd /bibapp/__build__/source/ruby
    * $ wget http://rubyforge.org/frs/download.php/64475/ruby-enterprise-1.8.7-20090928.tar.gz
    * $ tar xvfz ruby-enterprise-1.8.7-20090928.tar.gz
    * $ cd ruby-enterprise-1.8.7-20090928
  # Install Ruby Enterprise Edition:
    * $ cd /bibapp/__build__/source/ruby
    * $ export CFLAGS="-I/usr/sfw/include"
    * $ ./ruby-enterprise-1.8.7-20090928/installer
    * Where would you like to install Ruby Enterprise Edition to?
      * [/opt/ruby-enterprise-1.8.7-20090928] : /bibapp-qa/ruby/ruby-enterprise-1.8.7-20090928
  # Configure the Ruby Enterprise Edition environment, overriding the base ruby install performed earlier:
    * Edit ~/.profile:
      {{{
         RUBY_HOME=/bibapp-qa/ruby/ruby-enterprise-1.8.7-20090928
         export RUBY_HOME
         PATH=$RUBY_HOME/bin:$PATH
         export PATH
      }}}           
    * $ unset PATH
    * $ . ~/.profile

===Apache===

Apache 2.2.13 webserver (/bibapp/apache/apache-2.2.13)
    The Apache webserver is the semi-public face of the bibapp. as well as static HTML. 
    The webserver contains the basic set of modules, plus mod_ssl, mod_proxy*, and mod_rewrite.

Apache install notes

  # Get Apache, unpack:
    * mkdir /bibapp/apache
    * mkdir /bibapp/logs/apache
    * mkdir /bibapp/apache/content
    * cd /bibapp/__build__/source
    * mkdir apache/apache-2.2.13; cd apache/apache-2.2.13
    * wget http://mirror.atlanticmetro.net/apache/httpd/httpd-2.2.13.tar.gz
    * wget http://www.apache.org/dist/httpd/httpd-2.2.13.tar.gz.md5
    * md5sum httpd-2.2.13.tar.gz
    * md5sum -c httpd-2.2.13.tar.gz.md5
    * tar xvfz httpd-2.2.13.tar.gz
  # Configure, make, make install:
    * cd /bibapp/__build__/source/apache/apache-2.2.13/httpd-2.2.13
    * ./configure --prefix=/bibapp/apache/apache-2.2.13 \ --with-mpm=prefork \ --enable-mods-shared=most \ --enable-proxy \ --enable-ssl \ --with-ssl=/usr/sfw
    * make
    * make install
  # Compile and install Passenger (from gem)
    * gem install passenger --version'=2.2.2'
    * export APXS2=/bibapp/apache/apache-2.2.13/bin/apxs; passenger-install-apache2-module
  # Set up the webserver
    * cd /bibapp/apache/apache-2.2.11
    * rm -rf manual logs man cgi-bin htdocs
    * # Set up the Apache configurations for the webserver
    * cd conf
    * mv httpd.conf bibapp.conf
    * vi bibapp.conf

---- 

== Same as Ubuntu ==

  # Add passenger lines to /bibapp/apache/apache-2.2.13/conf/bibapp.conf
    {{{
LoadModule passenger_module /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.2.5/ext/apache2/mod_passenger.so
PassengerRoot /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.2.5
PassengerRuby /opt/ruby-enterprise/bin/ruby

<VirtualHost *:80>
  ServerName localhost
  DocumentRoot /path/to/rails_projects
  RailsBaseURI /bibapp
  <Directory /path/to/rails_projects>
    AllowOverride All
    Options Indexes FollowSymLinks MultiViews
    Order allow,deny
    Allow from all
  </Directory>
  RailsEnv development
</VirtualHost>
    }}}
    * NB. The /path/to/rails_projects will be the path to where you create symbolic links to your bibapp/public folder. In order for Passenger to process sub-URLs correctly, this sym link has to have the same name as your sub-URL. 
    {{{
(e.g., URL      => http://mydomain.edu/bibapp
       sym link => ln -s /path/to/bibapp/public /path/to/rails_projects/bibapp)
    }}}
    * More on this at Step 16.
  # Install PostgreSQL or MySQL
  # Download !BibApp code
    {{{
svn checkout http://bibapp.googlecode.com/svn/trunk/ ~/bibapp/
    }}}
  # Adjust permissions for attachment and logs
    * NB. Passenger implements user switching based on the owner of config/environment.rb, so ifconfig/environment.rb is owned by joe, Passenger will launch the corresponding Rails application as joe as well
  # Configure BibApp settings in the config/ directory
  # Install rake
    {{{
gem list rake #see if it's there
gem install rake #if not, install it
    }}}
  # Install database driver gem
    {{{
gem install postgres -- --with-pgsql-dir=/path/to/pgsql 
gem install mysql -- --with-mysql-dir=/path/to/mysql 
    }}}
  # Database Setup:
    # Create bibapp user
      {{{
createuser -dSRP bibapp
      }}}
    # Create bibapp database
      {{{
createdb -U bibapp -E UNICODE bibapp_development
      }}}
  # Generate BibApp database structure
    {{{
rake db:schema:load
    }}}
  # Create an 'admin' user, and load publishers from SHERPA/RoMEO
    {{{
rake db:seed
    }}}
  # Create a symbolic link to your bibapp/public directory
    {{{
ln -s ~/bibapp/public ~/rails_projects/bibapp
    }}}
  # Start !BibApp (starts solr, delayed_job, and passenger)
    {{{
rake bibapp:start
    }}}